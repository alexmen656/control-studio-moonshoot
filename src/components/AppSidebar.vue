<template>
    <div class="w-64 bg-white dark:bg-gray-800 flex flex-col fixed left-0 top-15 bottom-0 sidebar">
        <div class="px-2 pb-4 pt-2 relative">
            <button @click.stop="showNewDropdown = !showNewDropdown"
                class="flex items-center space-x-3 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-600 rounded-full px-6 py-3 w-full transition-all group">
                <svg class="w-6 h-6 text-primary-600 dark:text-primary-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium text-gray-900 dark:text-gray-100">New</span>
            </button>
            <div v-if="showNewDropdown" @click.stop
                class="absolute left-2 w-60 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50">
                <!--<button @click="createNewFolder"
                    class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-3 transition-colors">
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" />
                    </svg>
                    <div>
                        <div class="text-sm font-medium text-gray-900 dark:text-gray-100">New Post</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Create a new post (coming soon)</div>
                    </div>
                </button>-->
                <button @click="triggerVideoUpload"
                    class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-3 transition-colors">
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"
                            clip-rule="evenodd" />
                    </svg>
                    <div>
                        <div class="text-sm font-medium text-gray-900 dark:text-gray-100">Longformat Video upload</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Upload video files from your device</div>
                    </div>
                </button>
                <button @click="triggerVideoUpload"
                    class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-3 transition-colors">
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"
                            clip-rule="evenodd" />
                    </svg>
                    <div>
                        <div class="text-sm font-medium text-gray-900 dark:text-gray-100">Shortformat Video upload</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Upload video files from your device</div>
                    </div>
                </button>
                <button @click="triggerVideoUpload"
                    class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-3 transition-colors">
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"
                            clip-rule="evenodd" />
                    </svg>
                    <div>
                        <div class="text-sm font-medium text-gray-900 dark:text-gray-100">Create Post</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Create a post with our post creation tool
                        </div>
                    </div>
                </button>
            </div>
        </div>
        <nav class="flex-1 px-2 space-y-1 overflow-y-auto">
            <router-link to="/activity"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-900 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium">Activity</span>
            </router-link>
            <router-link to="/posts"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-900 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium">My Posts</span>
            </router-link>
            <router-link to="/dashboard"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-900 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path
                        d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z" />
                </svg>
                <span class="text-sm font-medium">My Videos</span>
            </router-link>

            <!--<router-link to="/planning"
                    class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                    active-class="bg-red-100 dark:bg-red-900/30 text-primary-700 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                        <path fill-rule="evenodd"
                            d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.001a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.001a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"
                            clip-rule="evenodd" />
                    </svg>
                    <span class="text-sm font-medium">Planning</span>
                </router-link>-->

            <router-link to="/schedule"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-700 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium">Schedule</span>
            </router-link>

            <router-link to="/analytics"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-700 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path
                        d="M3 3a1 1 0 011-1h1a1 1 0 011 1v14a1 1 0 01-1 1H4a1 1 0 01-1-1V3zm5 6a1 1 0 011-1h1a1 1 0 011 1v8a1 1 0 01-1 1H9a1 1 0 01-1-1V9zm5-4a1 1 0 011-1h1a1 1 0 011 1v12a1 1 0 01-1 1h-1a1 1 0 01-1-1V5z" />
                </svg>

                <span class=" text-sm font-medium">Analytics</span>
            </router-link>
            <router-link to="/accounts"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-700 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium">Accounts</span>
            </router-link>
            <router-link to="/project-settings"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-900 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"
                        clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium">Project Settings</span>
            </router-link>
            <router-link to="/workers"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-900 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a1 1 0 011 1v1.323l3.954 1.582 1.599-.8a1 1 0 01.894 1.79l-1.233.616 1.738 5.42a1 1 0 01-.285 1.05A3.989 3.989 0 0115 15a3.989 3.989 0 01-2.667-1.019 1 1 0 01-.285-1.05l1.738-5.42-1.233-.617a1 1 0 01.894-1.788l1.599.799L11 4.323V3a1 1 0 011-1zm-5 8.274l-.818 2.552c-.25.78.008 1.626.69 2.193A3.989 3.989 0 007 15a3.989 3.989 0 002.128-.981c.682-.567.94-1.413.69-2.193l-.818-2.552a1 1 0 00-1.9 0z"/>
                </svg>
                <span class="text-sm font-medium">Workers</span>
            </router-link>
            <router-link to="/profile"
                class="flex items-center space-x-3 px-4 py-2.5 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-full transition-colors"
                active-class="bg-red-100 dark:bg-red-900/30 text-primary-900 dark:text-primary-200 hover:bg-primary-100 dark:hover:bg-red-900/40">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd" />
                </svg>
                <span class="text-sm font-medium">Profile</span>
            </router-link>
            <div class="border-t border-gray-200 dark:border-gray-700 my-2"></div>
            <div class="px-4 pt-2">
                <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Storage</span>
            </div>
            <div class="px-4 py-2">
                <div class="space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600 dark:text-gray-400">{{ storageUsed }} {{ unit }} of {{
                            storageTotal
                            }}
                            GB
                            used</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div v-if="usedBytes" class="bg-gray-600 dark:bg-gray-400 rounded-full h-2 transition-all"
                            :style="{ width: storagePercent > 3 ? storagePercent + '%' : '3%' }">
                        </div>
                    </div>
                    <!-- <button
                            class="text-xs text-gray-600 dark:text-gray-400 hover:text-primary-700 dark:hover:text-primary-400 font-medium hover:underline">
                            Upgrade to Pro
                        </button>-->
                </div>
            </div>
        </nav>
        <div class="px-2 border-t border-gray-200 dark:border-gray-700 relative pb-2"><!--pb-4-->
            <button @click="toggleProjectDropdown"
                class="w-full flex items-center justify-between mt-2 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors group"><!-- mt-4-->
                <div class="flex items-center gap-3">
                    <div v-if="currentProject" class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0"
                        :style="{ background: `linear-gradient(to bottom right, ${currentProject.color1}, ${currentProject.color2})` }">
                        <span class="text-white font-bold text-sm">{{ currentProject.initials }}</span>
                    </div>
                    <div v-else
                        class="w-8 h-8 bg-gradient-to-br from-red-500 to-pink-600 rounded-lg flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold text-sm">TP</span>
                    </div>
                    <div class="text-left">
                        <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ currentProject?.name ||
                            'Testproject' }}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Active workspace</div>
                    </div>
                </div>
                <svg class="w-5 h-5 text-gray-400 dark:text-gray-500 transition-transform"
                    :class="{ 'rotate-180': showProjectDropdown }" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </button>
            <div v-if="showProjectDropdown"
                class="absolute bottom-full left-2 right-2 mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 max-h-64 overflow-y-auto">
                <button v-for="project in projects" :key="project.id" @click="switchProject(project)"
                    :class="{ 'bg-gray-50 dark:bg-gray-700': currentProject?.id === project.id }"
                    class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 transition-colors">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                        :style="{ background: `linear-gradient(to bottom right, ${project.color1}, ${project.color2})` }">
                        <span class="text-white font-bold text-sm">{{ project.initials }}</span>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-900 dark:text-gray-100">{{ project.name }}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">{{ project.video_count || 0 }} videos
                        </div>
                    </div>
                </button>
                <div class="border-t border-gray-200 dark:border-gray-700 my-2"></div>
                <button @click="createNewProject"
                    class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 transition-colors text-primary-600 dark:text-primary-400">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                            clip-rule="evenodd" />
                    </svg>
                    <span class="text-sm font-medium">Create new project</span>
                </button>
            </div>
        </div>
    </div>
</template>
<script lang="ts">

interface Project {
    id: number;
    name: string;
    initials: string;
    color1: string;
    color2: string;
    video_count?: number;
    user_id: number;
}

export default {
    name: 'AppSidebar',
    data() {
        return {
            storageUsed: 0,
            storageUsedInGB: 0,
            storageTotal: 0,
            unit: 'GB',
            showNewDropdown: false,
            showProjectDropdown: false,
            currentDrive: 'default',
            currentFolder: '',
            usedBytes: 0,
            totalBytes: 0,
            storagePercent: 0,
            projects: [] as Project[],
            currentProject: null as Project | null
        };
    },
    created() {
        this.fetchUsedStorage();
        this.fetchProjects();
    },
    mounted() {
        document.addEventListener('click', this.handleClickOutside);
        window.addEventListener('project-changed', this.handleProjectChanged);
    },
    beforeUnmount() {
        document.removeEventListener('click', this.handleClickOutside);
        window.removeEventListener('project-changed', this.handleProjectChanged);
    },
    methods: {
        handleClickOutside(event: MouseEvent) {
            const target = event.target as HTMLElement;
            if (!target.closest('.sidebar')) {
                this.showNewDropdown = false;
                this.showProjectDropdown = false;
            }
        },
        handleProjectChanged(event: any) {
            if (event.detail) {
                this.currentProject = event.detail;
                const index = this.projects.findIndex(p => p.id === event.detail.id);
                if (index !== -1) {
                    this.projects[index] = { ...this.projects[index], ...event.detail };
                }
            }
        },
        toggleProjectDropdown() {
            this.showProjectDropdown = !this.showProjectDropdown;
        },
        async fetchProjects() {
            try {
                const user = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user') as string) : null;
                if (!user) return;

                const response = await (this as any).$axios.get(`/projects?user_id=${user.id}`);
                this.projects = response.data;

                const savedProjectId = localStorage.getItem('currentProjectId');
                if (savedProjectId) {
                    this.currentProject = this.projects.find(p => p.id === Number(savedProjectId)) || this.projects[0] || null;
                } else {
                    this.currentProject = this.projects[0] || null;
                    if (this.currentProject) {
                        localStorage.setItem('currentProjectId', String(this.currentProject.id));
                    }
                }
            } catch (error) {
                console.error('Error fetching projects:', error);
            }
        },
        switchProject(project: Project) {
            this.currentProject = project;
            localStorage.setItem('currentProjectId', String(project.id));
            this.showProjectDropdown = false;
            window.dispatchEvent(new CustomEvent('project-changed', { detail: project }));
        },
        async createNewProject() {
            const projectName = prompt('Enter project name:');
            if (!projectName) return;

            try {
                const user = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user') as string) : null;
                if (!user) return;

                const initials = projectName.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2);

                const colors: [string, string][] = [
                    ['#ef4444', '#dc2626'],
                    ['#3b82f6', '#9333ea'],
                    ['#10b981', '#14b8a6'],
                    ['#f59e0b', '#ea580c'],
                    ['#8b5cf6', '#ec4899']
                ];
                const randomColor = colors[Math.floor(Math.random() * colors.length)] ?? colors[0];

                const response = await (this as any).$axios.post('/projects', {
                    name: projectName,
                    initials: initials,
                    color1: randomColor![0],
                    color2: randomColor![1],
                    user_id: user.id
                });

                this.projects.push(response.data);
                this.switchProject(response.data);
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Failed to create project');
            }
        },
        triggerVideoUpload() {
            this.showNewDropdown = false;
            if (this.$route.path !== '/dashboard') {
                this.$router.push('/dashboard').then(() => {
                    setTimeout(() => {
                        const vueApp = (window as any).vueApp;
                        if (vueApp) {
                            vueApp.config.globalProperties.$eventBus = vueApp.config.globalProperties.$eventBus || {};
                            window.dispatchEvent(new CustomEvent('open-upload-modal'));
                        }
                    }, 100);
                });
            } else {
                window.dispatchEvent(new CustomEvent('open-upload-modal'));
            }
        },
        fetchUsedStorage() {
            const currentProjectId = localStorage.getItem('currentProjectId');

            (this as any).$axios.get('/used-storage?project_id=' + currentProjectId).then((res: any) => {
                this.usedBytes = Number(res.data.used_storage);
                this.totalBytes = Number(res.data.total_storage);
                this.storagePercent = this.totalBytes
                    ? Number(((this.usedBytes / this.totalBytes) * 100).toFixed(2))
                    : 0;

                this.storageTotal = this.totalBytes ? Number((this.totalBytes / (1024 * 1024 * 1024)).toFixed(2)) : 0;
                this.storageUsed = Number(this.getSizeInUnit(this.usedBytes, this.getStorageUnit(this.usedBytes)));
                this.unit = this.getStorageUnit(this.usedBytes);
            })
        },
        getStorageUnit(bytes: number) {
            if (bytes < 1024) return 'Bytes';
            else if (bytes < 1024 * 1024) return 'KB';
            else if (bytes < 1024 * 1024 * 1024) return 'MB';
            else return 'GB';
        },
        getSizeInUnit(bytes: number, unit: string) {
            switch (unit) {
                case 'Bytes':
                    return bytes;
                case 'KB':
                    return (bytes / 1024).toFixed(2);
                case 'MB':
                    return (bytes / (1024 * 1024)).toFixed(2);
                case 'GB':
                    return (bytes / (1024 * 1024 * 1024)).toFixed(2);
                default:
                    return bytes;
            }
        },
    }
}
</script>

<style scoped>
.sidebar {
    background: #eff3f6;
}

@media (prefers-color-scheme: dark) {
    .sidebar {
        background: #1f2937;
    }
}

::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
}

@media (prefers-color-scheme: dark) {
    ::-webkit-scrollbar-thumb {
        background: #4b5563;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
    }
}
</style>
