import { compactDecrypt } from 'jose';
import { importPKCS8 } from 'jose';
import fs from 'fs';

const workerPrivateKeyPem = fs.readFileSync('keys/worker/worker-private.pem', 'utf8');
const workerPrivateKey = await importPKCS8(workerPrivateKeyPem, 'RSA-OAEP');

const token = "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.XMfrrNPnYh4gqOzdvq4l5Vh4I22EJUbhFB1xUGfNaemDhXxw7gYYA8lXzJKz20okTSFewgbC2edTCycIIuPieCIQBJp2kBaXd2gP3ryhzO99zW4SYu-kyDmbzbYOgYEBkbR-LnE76Db1gFjGq5TEZvUwSVajZPKB2J40eWOKtpXfGMRZudq6pXsIednjTlYUYNR-i8gszP5f8c3Vfu__etYiBlHHisLtqqn1yarNEfEj5TGO5vOGKtRuEJtiQwmyD9nY7VvCmB_3NhuRrC-tE6lLQHwXv9UP8Zs8oj8si2WZyCAPardy7JpaLBQyZqMUAn0ctCroKl1jLzpS5JnayJcepE0ezU3JCGVDtNPeFqHCv9zmy5Hc_meFYeToH0cIbqjRoDHqRpmr48eXuVT1jo7UkDQxz7Tbl5iR7gUNw_9o7oVN8SzyyaTQFB2yykAQNCR0HSqkotDrBS7dEDe6U4UJTAkv_68H6_yvyKz8XN2FeKOoAOd09m2f3lazh9COZydT4DB1q32t15oqYMK9FpfFBvUpKy8oKneUf2CneJG9QccBSieT_a1NWw7GqDxPjAbrHijN4QYGJfi9J1a_bzeqvRh2Un2CUJLsHQDXu0drXLE-2pdL1DqnhmhgdSoBGmQDFdpmyrxuD1Mk9jdQ1LB0GYUGeEceGnuS-mpujv0.v9YrE6gk7M68l2GQ.J9ul828SnyuOUVJg1u5JufX5jAPM8qQujBQ9YtM80hCwvEnV9zFCin4iwCwoVOsx9RV9g3SUg1YVB0qfirRe0zaZv101AGJSut9msSwRjOhUXB-oQydk509xr7Xept2jXIrqenE-ZGS-H00l-orWamHt04ePEzHsw0qpZRovF7XFUuVE8CEkXNaajus0ovZIHgmV1uy-G67sG_lhUip19E9kdxHcmvNLZF3Q2YRWwpNYVhx5Ki9wweKzwiAdDrKr2paERowL8rgOZKVeIatnu3RwQwuMryuCI3g6B7GEndOqDOi3ddV8vuUqmrHDLdXHUzfn2HiJzR1uM9tOyZV24DFtrwKHiMaoeoIQeQ94tUC9V6Xhuyb5_bryvNGd7qLSQmuX97XcyjE6rZC1YWFPvggu1F0_LMDeCDn9yXNRqtkvE3--noDsCVOTt4ztkAUiIh8cV9EHt2WQcmzAF-h0I47BDNkzVa-FqugJ9yLOKSBCozBy-LZyKXYvHRp7SL8kCLRLp3mn7QjzX6NzGo3Sy7JIdkYk2Fmf7n0ctuXytXnD3GGERIiEHED3V_n5TsKIzQxX1BlnLmsdcYfgGoDaTOQQ0FvAJvR8RaYDXXS1pSgDFTkeglqb1vA2dWiUDObHSt8YVlohxqNgf34zcRiOPmuB0mAwd10izLXLgTZSzyaflXIMArJdr-ALeDtgFK3Zfe0jJ1-tZDCSrvFaSpOPw-bkm-pM0MGRDhLM3fqAJS-qH2xgbEWBlthybVA9Ca0kX7xD_hJMED-rFsVCtqZY0R_QrOxJFtSw-zWlQmjE64xu0LRjrp9LEj3abo3Yqb1kXdzf4TFZ98lHDJ5VIDIjZYwqrVOCkVkqZOwDy1ZlAjtq1W8fgDKBZtAFnfAt-HupduSe616sQMW5aDnOmj6OhwMZfJvpbqCwhFMfiqbwVkK7TIhd2jRxyOteWGxnifp42GeX8wh4e-BG_pH2HEGAnAWlfZTHY97DSY2xU68EZPPiqpiy_lnm9EGEqKsNVRvt4XONJgTsKtgQyR1G8x9rslcitRq6WE41dL0bXx9p5VDXQm0h5jOBC2-QZA7QVK2nf4kgF_MP_aenBdcAzOaVX9W3aiKesAFK_dQ8e7FLKKuFbstYmcaZ-IhZJfGArln6ELtqvM3Bq2OxqMVJsf9elbdMShZl4ngrQxOD16K0BTUcBGDzA5UcTWxy3rGBfTybZbHV9WbepgemDYnfi2GVXRON-PKnPL_Khzuqpw6qEhQ2fmba8o8XzJvze8uIo8oCSXT_AvfkwaSOUmA9ELqi_k8GApVzBu_-7UvTkKP7SwV3rOCOweYL6MqG7ffNqtZ8PS7Is6ZJiZFZTPup8At-pG1Z29BtnrJHc2P3j6WpH9Qpfg9QoOuRHOp49lLZcjhjKrunDrPdDYSwv1YNzF07j3t1IfAfyDmphNnSzqUsaODQYWomk3Sd_eI1Ekc6NavGdXiO5RMd1cLi0xkxPRdByBj-ap6CnhMTRX8gndLulP3ERGYqtfZj5yf2B2mdwZol7oPVS5C2SHUzuZbm6_HHR660TWvUBzEw6_kI9uA6Zuu--0yxshSWUZW8FOKaN43VS7cUUof-IQDykEhRCHX8bGGLQd8_Z02mKTIbDjngdkrJZ2ViXX6o3kvQu8z2RmxWTKENIPfq2mFZq05N.me3kh7XUWApOmXiUNVOljA";

const { plaintext } = await compactDecrypt(token, workerPrivateKey);
const decrypted = new TextDecoder().decode(plaintext);

console.log("Decrypted:", decrypted);